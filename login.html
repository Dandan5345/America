<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>מסע חלומות 🗽 התחברות</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Assistant:wght@300;400;600;700&display=swap" rel="stylesheet">

    <style>
        body { font-family: 'Assistant', sans-serif; background-color: #e2e8f0; }
        .form-input { transition: all 0.2s ease-in-out; }
        .form-input:focus { border-color: #38bdf8; box-shadow: 0 0 0 2px #38bdf840; }
    </style>
</head>
<body class="flex items-center justify-center min-h-screen bg-slate-200">

    <div class="w-full max-w-md p-8 space-y-6 bg-white rounded-2xl shadow-lg">
        <div class="text-center">
            <h2 class="text-3xl font-bold text-slate-800">ברוכים הבאים למסע</h2>
            <p class="text-slate-500">התחברו כדי לגשת למידע הפרטי שלכם</p>
        </div>

        <!-- Auth Forms: Login and Signup -->
        <div id="auth-forms">
            <!-- Login Form -->
            <form id="login-form" class="space-y-4">
                <div>
                    <label for="login-email" class="block text-sm font-medium text-slate-700">אימייל</label>
                    <input type="email" id="login-email" required class="form-input mt-1 block w-full p-2 border border-slate-300 rounded-lg">
                </div>
                <div>
                    <label for="login-password" class="block text-sm font-medium text-slate-700">סיסמה</label>
                    <input type="password" id="login-password" required class="form-input mt-1 block w-full p-2 border border-slate-300 rounded-lg">
                </div>
                <button type="submit" class="w-full bg-blue-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-blue-700 transition">התחבר</button>
                <p class="text-sm text-center">אין לכם חשבון? <button type="button" id="show-signup" class="font-semibold text-blue-600 hover:underline">הרשמו כאן</button></p>
            </form>

            <!-- Signup Form (hidden by default) -->
            <form id="signup-form" class="space-y-4 hidden">
                 <div>
                    <label for="signup-email" class="block text-sm font-medium text-slate-700">אימייל</label>
                    <input type="email" id="signup-email" required class="form-input mt-1 block w-full p-2 border border-slate-300 rounded-lg">
                </div>
                <div>
                    <label for="signup-password" class="block text-sm font-medium text-slate-700">סיסמה (לפחות 6 תווים)</label>
                    <input type="password" id="signup-password" required class="form-input mt-1 block w-full p-2 border border-slate-300 rounded-lg">
                </div>
                <button type="submit" class="w-full bg-green-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-green-700 transition">הרשם</button>
                <p class="text-sm text-center">כבר רשומים? <button type="button" id="show-login" class="font-semibold text-blue-600 hover:underline">התחברו כאן</button></p>
            </form>
        </div>

        <!-- Social Login Divider -->
        <div class="relative flex py-2 items-center">
            <div class="flex-grow border-t border-slate-300"></div>
            <span class="flex-shrink mx-4 text-slate-400">או</span>
            <div class="flex-grow border-t border-slate-300"></div>
        </div>
        <button id="google-login-btn" class="w-full flex items-center justify-center gap-3 bg-white border border-slate-300 text-slate-700 font-bold py-2 px-4 rounded-lg hover:bg-slate-50 transition">
            <img class="w-6 h-6" src="https://www.svgrepo.com/show/475656/google-color.svg" alt="Google icon">
            התחברות עם גוגל
        </button>
        
        <!-- Status/Error Message -->
        <p id="auth-status" class="text-center text-red-500 font-medium h-4"></p>
        <p class="text-center text-xs text-slate-400 mt-4">
            <a href="index.html" class="hover:underline">חזרה לדף הבית</a>
        </p>
    </div>

    <!-- Firebase and App Logic -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-app.js";
        import {
          getAuth,
          createUserWithEmailAndPassword,
          signInWithEmailAndPassword,
          GoogleAuthProvider,
          signInWithPopup,
          onAuthStateChanged,
          signOut
        } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-auth.js";

        // Firebase configuration שנוצר בפרויקט שלך
        const firebaseConfig = {
          apiKey: "AIzaSyBuhPaw4P-rLeb1Xzou2COUE1O0hX3z44w",
          authDomain: "america1tour.firebaseapp.com",
          projectId: "america1tour",
          storageBucket: "america1tour.firebasestorage.app",
          messagingSenderId: "70515728009",
          appId: "1:70515728009:web:aded0696b4f72c910b7058",
          measurementId: "G-S29LD2DT7S"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);

        const loginForm = document.getElementById('login-form');
        const signupForm = document.getElementById('signup-form');
        const googleLoginBtn = document.getElementById('google-login-btn');
        const authStatus = document.getElementById('auth-status');
        const showSignupBtn = document.getElementById('show-signup');
        const showLoginBtn = document.getElementById('show-login');

        // Toggle between login and signup forms
        showSignupBtn.addEventListener('click', () => {
            loginForm.classList.add('hidden');
            signupForm.classList.remove('hidden');
            authStatus.textContent = '';
        });
        showLoginBtn.addEventListener('click', () => {
            signupForm.classList.add('hidden');
            loginForm.classList.remove('hidden');
            authStatus.textContent = '';
        });

        // Handle successful login
        const handleLoginSuccess = (user) => {
            authStatus.textContent = `התחברת בהצלחה! מעביר אותך...`;
            authStatus.className = "text-center text-green-500 font-medium h-4";
            setTimeout(() => {
                window.location.href = 'index.html';
            }, 1500);
        };

        // Email/Password Signup
        signupForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const email = signupForm['signup-email'].value;
            const password = signupForm['signup-password'].value;
            authStatus.textContent = '';
            try {
                const userCredential = await createUserWithEmailAndPassword(auth, email, password);
                handleLoginSuccess(userCredential.user);
            } catch (error) {
                authStatus.textContent = `שגיאת הרשמה: ${error.message}`;
            }
        });

        // Email/Password Login
        loginForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const email = loginForm['login-email'].value;
            const password = loginForm['login-password'].value;
            authStatus.textContent = '';
            try {
                const userCredential = await signInWithEmailAndPassword(auth, email, password);
                handleLoginSuccess(userCredential.user);
            } catch (error) {
                authStatus.textContent = `שגיאת התחברות: ${error.message}`;
            }
        });

        // Google Login
        googleLoginBtn.addEventListener('click', async () => {
            const provider = new GoogleAuthProvider();
            authStatus.textContent = '';
            try {
                const result = await signInWithPopup(auth, provider);
                handleLoginSuccess(result.user);
            } catch (error) {
                authStatus.textContent = `שגיאת התחברות עם גוגל: ${error.message}`;
            }
        });

        // Check auth state on page load
        onAuthStateChanged(auth, (user) => {
            if (user) {
                console.log("User is already logged in:", user.email);
            }
        });
    </script>
</body>
</html>